/*! version:1.4.13 */
define(function(){return function(t){function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var e={};return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="./dist/dmap/leaflet/",n(n.s=156)}({156:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});e(157);n.default=function(t,n){return L.velocityLayer(T.assign({displayValues:!0,displayOptions:{velocityType:"GBR Wind",displayPosition:"bottomleft",displayEmptyString:"No wind data"},data:t,maxVelocity:10},n))}},157:function(t,n,e){"use strict";var o=e(158),i=e(159);e.n(i);L.VelocityLayer=L.Layer.extend({options:{displayValues:!0,displayOptions:{velocityType:"Velocity",position:"bottomleft",emptyString:"No velocity data"},maxVelocity:10,colorScale:null,data:null},_timer:0,initialize:function(t){var n=this;L.setOptions(this,t),this.ajax=T.one(function(t){return T.ajax({f:"json",url:t,success:function(t){n.setData(t)}})})},onAdd:function(t){this._canvasLayer=L.canvasLayer().delegate(this),this._canvasLayer.addTo(t),this._map=t},onRemove:function(t){this._destroyWind()},setData:function(t){this.options.data=t,this._windy&&(this._windy.setData(t),this._clearAndRestart()),this.fire("load")},onDrawLayer:function(t,n){var e=this,o=(e._windy,e.options),i=e._timer;if(!this._windy)return void this._initWindy(e);var a=o.data,r=o.url;if(!a)return void(r&&this.ajax(r));i&&clearTimeout(i),this._timer=setTimeout(function(){e._startWindy()},750)},_startWindy:function(){var t=this._map.getBounds(),n=this._map.getSize();this._windy.start([[0,0],[n.x,n.y]],n.x,n.y,[[t._southWest.lng,t._southWest.lat],[t._northEast.lng,t._northEast.lat]])},_initWindy:function(t){this._windy=new o.a(T.assign({canvas:t._canvasLayer._canvas},t.options)),this._context=this._canvasLayer._canvas.getContext("2d"),this._canvasLayer._canvas.classList.add("velocity-overlay"),this.onDrawLayer(),this._map.on("dragstart",t._windy.stop).on("dragend",t._clearAndRestart).on("zoomstart",t._windy.stop).on("zoomend",t._clearAndRestart).on("resize",t._clearWind),this._initMouseHandler()},_initMouseHandler:function(){if(!this._mouseControl&&this.options.displayValues){var t=this.options.displayOptions||{};t.leafletVelocity=this,this._mouseControl=L.control.velocity(t).addTo(this._map)}},_clearAndRestart:function(){this._context&&this._context.clearRect(0,0,3e3,3e3),this._windy&&this._startWindy()},_clearWind:function(){this._windy&&this._windy.stop(),this._context&&this._context.clearRect(0,0,3e3,3e3)},_destroyWind:function(){this._timer&&clearTimeout(this._timer),this._windy&&this._windy.stop(),this._context&&this._context.clearRect(0,0,3e3,3e3),this._mouseControl&&this._map.removeControl(this._mouseControl),this._mouseControl=null,this._windy=null,this._map.removeLayer(this._canvasLayer)}}),L.velocityLayer=function(t){return new L.VelocityLayer(t)}},158:function(t,n,e){"use strict";var o=function(t){var n,e,o,i,a,r,s,l,c,u,h=t.minVelocity||0,d=t.maxVelocity||10,f=(t.velocityScale||.005)*(Math.pow(window.devicePixelRatio,1/3)||1),p=t.particleAge||90,y=t.lineWidth||1,v=t.particleMultiplier||1/300,m=Math.pow(window.devicePixelRatio,1/3)||1.6,_=t.frameRate||15,g=1e3/_,M=["rgb(36,104, 180)","rgb(60,157, 194)","rgb(128,205,193 )","rgb(151,218,168 )","rgb(198,231,181)","rgb(238,247,217)","rgb(255,238,159)","rgb(252,217,125)","rgb(255,182,100)","rgb(252,150,75)","rgb(250,112,52)","rgb(245,64,32)","rgb(237,45,28)","rgb(220,24,32)","rgb(180,0,35)"],w=t.colorScale||M,x=[NaN,NaN,null],b=t.data,C=function(t){b=t},T=function(t,n,e,o,i,a){var r=1-t,s=1-n,l=r*s,c=t*s,u=r*n,h=t*n,d=e[0]*l+o[0]*c+i[0]*u+a[0]*h,f=e[1]*l+o[1]*c+i[1]*u+a[1]*h;return[d,f,Math.sqrt(d*d+f*f)]},P=function(t,n){var e=t.data,o=n.data;return{header:t.header,data:function(t){return[e[t],o[t]]},interpolate:T}},W=function(t){var n=null,e=null,o=null;return t.forEach(function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":n=t;break;case"1,3":case"2,3":e=t;break;default:o=t}}),P(n,e)},S=function(t,u){n=W(t);var h=n.header;i=h.lo1,a=h.la1,r=h.dx,s=h.dy,l=h.nx,c=h.ny,o=new Date(h.refTime),o.setHours(o.getHours()+h.forecastTime),e=[];for(var d=0,f=Math.floor(l*r)>=360,p=0;p<c;p++){for(var y=[],v=0;v<l;v++,d++)y[v]=n.data(d);f&&y.push(y[0]),e[p]=y}u({date:o,interpolate:D})},D=function(t,o){if(!e)return null;var l,c=R(t-i,360)/r,u=(a-o)/s,h=Math.floor(c),d=h+1,f=Math.floor(u),p=f+1;if(l=e[f]){var y=l[h],v=l[d];if(V(y)&&V(v)&&(l=e[p])){var m=l[h],_=l[d];if(V(m)&&V(_))return n.interpolate(c-h,u-f,y,v,m,_)}}return null},V=function(t){return null!==t&&void 0!==t},R=function(t,n){return t-n*Math.floor(t/n)},A=function(){return/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)},k=function(t,n,e,o,i,a,r,s){var l=r[0]*a,c=r[1]*a,u=N(t,n,e,o,i,s);return r[0]=u[0]*l+u[2]*c,r[1]=u[1]*l+u[3]*c,r},N=function(t,n,e,o,i,a){var r=2*Math.PI,s=Math.pow(10,-5.2),l=n<0?s:-s,c=e<0?s:-s,u=j(e,n+l,a),h=j(e+c,n,a),d=Math.cos(e/360*r);return[(u[0]-o)/l/d,(u[1]-i)/l/d,(h[0]-o)/c,(h[1]-i)/c]},O=function(t,n,e){function o(n,e){var o=t[Math.round(n)];return o&&o[Math.round(e)]||x}o.release=function(){t=[]},o.randomize=function(t){var e,i,a=0;do{e=Math.round(Math.floor(Math.random()*n.width)+n.x),i=Math.round(Math.floor(Math.random()*n.height)+n.y)}while(null===o(e,i)[2]&&a++<30);return t.x=e,t.y=i,t},e(n,o)},E=function(t,n,e){var o=t[0],i=t[1],a=Math.round(o[0]),r=Math.max(Math.floor(o[1],0),0);Math.min(Math.ceil(i[0],n),n-1);return{x:a,y:r,xMax:n,yMax:Math.min(Math.ceil(i[1],e),e-1),width:n,height:e}},H=function(t){return t/180*Math.PI},I=function(t){return t/(Math.PI/180)},z=function(t,n,e){var o=e.east-e.west,i=e.width/I(o)*360/(2*Math.PI),a=i/2*Math.log((1+Math.sin(e.south))/(1-Math.sin(e.south))),r=e.height+a,s=(r-n)/i,l=180/Math.PI*(2*Math.atan(Math.exp(s))-Math.PI/2);return[I(e.west)+t/e.width*I(o),l]},F=function(t){return Math.log(Math.tan(t/2+Math.PI/4))},j=function(t,n,e){var o=F(e.south),i=F(e.north),a=e.width/(e.east-e.west),r=e.height/(i-o),s=F(H(t)),l=(H(n)-e.west)*a,s=(i-s)*r;return[l,s]},q=function(t,n,e,o){function i(o){for(var i=[],r=n.y;r<=n.yMax;r+=2){var c=z(o,r,e);if(c){var u=c[0],h=c[1];if(isFinite(u)){var d=t.interpolate(u,h);d&&(d=k(a,u,h,o,r,s,d,e),i[r+1]=i[r]=d)}}}l[o+1]=l[o]=i}var a={},r=(e.south-e.north)*(e.west-e.east),s=f*Math.pow(r,.4),l=[],c=n.x;!function t(){for(var e=Date.now();c<n.width;)if(i(c),c+=2,Date.now()-e>1e3)return void setTimeout(t,25);O(l,n,o)}()},U=function(n,e){function o(){r.forEach(function(t){t.length=0}),l.forEach(function(t){t.age>p&&(e.randomize(t).age=0);var n=t.x,o=t.y,i=e(n,o),s=i[2];if(null===s)t.age=p;else{var l=n+i[0],c=o+i[1];null!==e(l,c)[2]?(t.xt=l,t.yt=c,r[a.indexFor(s)].push(t)):(t.x=l,t.y=c)}t.age+=1})}function i(){f.globalCompositeOperation="destination-in",f.fillRect(n.x,n.y,n.width,n.height),f.globalCompositeOperation="lighter",f.globalAlpha=.9,r.forEach(function(t,n){t.length>0&&(f.beginPath(),f.strokeStyle=a[n],t.forEach(function(t){f.moveTo(t.x,t.y),f.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),f.stroke())})}var a=function(t,n){return w.indexFor=function(e){return Math.max(0,Math.min(w.length-1,Math.round((e-t)/(n-t)*(w.length-1))))},w}(h,d),r=a.map(function(){return[]}),s=Math.round(n.width*n.height*v);A()&&(s*=m);for(var l=[],c=0;c<s;c++)l.push(e.randomize({age:Math.floor(Math.random()*p)+0}));var f=t.canvas.getContext("2d");f.lineWidth=y,f.fillStyle="rgba(0, 0, 0, 0.97)",f.globalAlpha=.6;var _=Date.now();!function t(){u=requestAnimationFrame(t);var n=Date.now(),e=n-_;e>g&&(_=n-e%g,o(),i())}()},B=function(t,n,e,o){var i={south:H(o[0][1]),north:H(o[1][1]),east:H(o[1][0]),west:H(o[0][0]),width:n,height:e};K(),S(b,function(o){q(o,E(t,n,e),i,function(t,n){G.field=n,U(t,n)})})},K=function(){G.field&&G.field.release(),L.Util.cancelAnimFrame(u)},G={params:t,start:B,stop:K,createField:O,interpolatePoint:D,setData:C};return G};n.a=o},159:function(t,n){L.Control.Velocity=L.Control.extend({options:{position:"bottomright",emptyString:"Unavailable",angleConvention:"bearingCCW",speedUnit:"m/s"},onAdd:function(t){return this._container=T.div("leaflet-control-velocity"),L.DomEvent.disableClickPropagation(this._container),t.on("mousemove",this._onMouseMove,this),this._container.innerHTML=this.options.emptyString,this._container},onRemove:function(t){t.off("mousemove",this._onMouseMove,this)},vectorToSpeed:function(t,n,e){var o=Math.sqrt(Math.pow(t,2)+Math.pow(n,2));return"k/h"===e?this.meterSec2kilometerHour(o):"kt"===e?this.meterSec2Knots(o):o},vectorToDegrees:function(t,n,e){e.endsWith("CCW")&&(n=n>0?n=-n:Math.abs(n));var o=Math.sqrt(Math.pow(t,2)+Math.pow(n,2)),i=Math.atan2(t/o,n/o),a=180*i/Math.PI+180;return"bearingCW"!==e&&"meteoCCW"!==e||(a+=180)>=360&&(a-=360),a},meterSec2Knots:function(t){return t/.514},meterSec2kilometerHour:function(t){return 3.6*t},_onMouseMove:function(t){var n=this,e=this.options.leafletVelocity._map.containerPointToLatLng(L.point(t.containerPoint.x,t.containerPoint.y)),o=this.options.leafletVelocity._windy.interpolatePoint(e.lng,e.lat),i="";i=o&&!isNaN(o[0])&&!isNaN(o[1])&&o[2]?"<strong>"+this.options.velocityType+" Direction: </strong>"+n.vectorToDegrees(o[0],o[1],this.options.angleConvention).toFixed(3)+"Â°, <strong>"+this.options.velocityType+" Speed: </strong>"+n.vectorToSpeed(o[0],o[1]).toFixed(1)+"m/s":this.options.emptyString,n._container.innerHTML=i}}),L.Map.mergeOptions({positionControl:!1}),L.Map.addInitHook(function(){this.options.positionControl&&(this.positionControl=new L.Control.MousePosition,this.addControl(this.positionControl))}),L.control.velocity=function(t){return new L.Control.Velocity(t)}}})});
//# sourceMappingURL=velocityLayer.js.map